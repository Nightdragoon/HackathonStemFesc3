@{
    ViewData["Title"] = "Home Page";
}

<!doctype html>
<html lang="es">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Mini formulario</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container py-4" style="max-width: 680px;">
    <div class="mb-3">
        <label for="msg" class="form-label">Mensaje</label>
        <input id="msg" class="form-control" placeholder="Escribe algo..." />
    </div>

    <button id="sendBtn" class="btn btn-primary">Enviar</button>

    <div id="output" class="mt-3 p-3 border rounded bg-light"></div>
</div>

<!-- jQuery -->
<script src="https://code.jquery.com/jquery-3.7.1.min.js"
        integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo="
        crossorigin="anonymous"></script>
<!-- Opcional: JS de Bootstrap -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/howler@2/dist/howler.core.min.js"></script>

<script>
    const urlChatGpt = '@Url.Action("GetChatGpt" , "Home")';
    const urlHumenAi = '@Url.Action("GetHumenAi" , "Home")';
    const urlEmotion = '@Url.Action("sendEmotion" , "Home")';

    $(function () {
      $('#sendBtn').on('click', async function () {
        const txt = $('#msg').val().trim();
        if (!txt) {
          $('#output').text('Escribe algo...');
          return;
        }
        let result = await fetch(urlChatGpt, {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                message: txt
            })
            
        });
          res = await result.json();
          
          $('#output').text(res);
          sendEmotion(txt);
          getAudio(res);




      });
    });
    
    async function getAudio(messages){
        console.log(messages);
        let result = await fetch(urlHumenAi, {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                message: messages
            })

        });
        res = await result.json();
        console.log(res);
        const mime = "audio/mpeg"; // o audio/wav, audio/ogg

        const sound = new Howl({
            src: [`data:${mime};base64,${res}`]
        });

        sound.play();
        
    }
    async function sendEmotion(messages) {
        let result = await fetch(urlEmotion, {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                message: messages
            })

        });
        res = await result.json();
        console.log(res);
        
        
    }
  </script>
</body>
</html>
